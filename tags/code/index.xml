<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>code on circuitshelter</title><link>https://www.circuitshelter.com/tags/code/</link><description>Recent content in code on circuitshelter</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Mon, 16 Aug 2021 18:08:53 +0000</lastBuildDate><atom:link href="https://www.circuitshelter.com/tags/code/index.xml" rel="self" type="application/rss+xml"/><item><title>backy: Tiny multiprocessing utility for file backups</title><link>https://www.circuitshelter.com/posts/backy-backup-utility/</link><pubDate>Mon, 16 Aug 2021 18:08:53 +0000</pubDate><guid>https://www.circuitshelter.com/posts/backy-backup-utility/</guid><description>Sometimes the best option is the simplest one. If you need something to reliably sync and archive files without unnecessary integrations and complicated logic this can be your thing.
No external dependencies or service authorizations, friendly CLI and small code base that you can read and understand.
Tis tool also can be used as a complementary solution for cloud agents like Dropbox or Google Drive (e.x continuously archive directories to cloud folder).</description><content>&lt;h2 id="sometimes-the-best-option-is-the-simplest-one">Sometimes the best option is the simplest one.&lt;/h2>
&lt;p>If you need something to reliably sync and archive files without unnecessary integrations and complicated logic this can be your thing.&lt;/p>
&lt;p>No external dependencies or service authorizations, friendly CLI and small code base that you can read and understand.&lt;/p>
&lt;p>Tis tool also can be used as a complementary solution for cloud agents like Dropbox or Google Drive (e.x continuously archive directories to cloud folder).&lt;/p>
&lt;p>Comes with install script for &lt;a href="https://support.apple.com/guide/terminal/script-management-with-launchd-apdc6c1077b-5d5d-4d35-9c19-60f2397b2369/mac">Launchd&lt;/a> in case you plan to natively schedule backup tasks for macOS 10.4+.&lt;/p>
&lt;p>&lt;strong>Features&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>Directories synchronization&lt;/li>
&lt;li>Full directories archiving: hourly, daily, weekly, monthly or yearly with auto re-archivation if archive lost or corrupted&lt;/li>
&lt;li>Using native rsync(rsync over SSH supported) and tar(+bzip2) tools from your OS&lt;/li>
&lt;li>No third-party dependencies&lt;/li>
&lt;li>Linux, macOS and *BSD supported&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>&lt;a href="https://github.com/vdbsh/backy">https://github.com/vdbsh/backy&lt;/a>&lt;/strong>&lt;/p></content></item><item><title>Hugo post generator</title><link>https://www.circuitshelter.com/posts/python-hugo-post-generator/</link><pubDate>Sat, 24 Jul 2021 14:53:09 +0000</pubDate><guid>https://www.circuitshelter.com/posts/python-hugo-post-generator/</guid><description>This python script will generate valid markdown template for hugo post and opens it in associated text editor. It&amp;rsquo;s cross-platform and have no dependencies.
#!/usr/bin/env python3 from datetime import datetime, timezone from platform import system from subprocess import call from sys import argv hugo_posts_dir = &amp;#39;/home/user/blog/content/posts&amp;#39; if __name__ == &amp;#39;__main__&amp;#39;: post_file = path.join(hugo_posts_dir, f&amp;#39;{argv[1].lower().replace(&amp;#34; &amp;#34;, &amp;#34;-&amp;#34;)}.md&amp;#39;) now = datetime.now(tz=timezone.utc) timestamp = now.strftime(&amp;#39;%Y-%m-%dT%H:%M:%SZ&amp;#39;) with open(post_file, &amp;#39;w&amp;#39;) as f: f.write(f&amp;#39;+++\n&amp;#39; f&amp;#39;date=&amp;#34;{timestamp}&amp;#34;\n&amp;#39; f&amp;#39;title=&amp;#34;{argv[1]}&amp;#34;\n&amp;#39; f&amp;#39;description=&amp;#34;&amp;#34;\n&amp;#39; f&amp;#39;categories=[]\n&amp;#39; f&amp;#39;tags=[]\n&amp;#39; f&amp;#39;cover=&amp;#34;&amp;#34;\n&amp;#39; f&amp;#39;+++\n\n&amp;#39;) os_id = system().</description><content>&lt;p>This python script will generate valid markdown template for hugo post and opens it in associated text editor. It&amp;rsquo;s cross-platform and have no dependencies.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#75715e">#!/usr/bin/env python3&lt;/span>
&lt;span style="color:#f92672">from&lt;/span> datetime &lt;span style="color:#f92672">import&lt;/span> datetime, timezone
&lt;span style="color:#f92672">from&lt;/span> platform &lt;span style="color:#f92672">import&lt;/span> system
&lt;span style="color:#f92672">from&lt;/span> subprocess &lt;span style="color:#f92672">import&lt;/span> call
&lt;span style="color:#f92672">from&lt;/span> sys &lt;span style="color:#f92672">import&lt;/span> argv
hugo_posts_dir &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;/home/user/blog/content/posts&amp;#39;&lt;/span>
&lt;span style="color:#66d9ef">if&lt;/span> __name__ &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#e6db74">&amp;#39;__main__&amp;#39;&lt;/span>:
post_file &lt;span style="color:#f92672">=&lt;/span> path&lt;span style="color:#f92672">.&lt;/span>join(hugo_posts_dir,
&lt;span style="color:#e6db74">f&lt;/span>&lt;span style="color:#e6db74">&amp;#39;&lt;/span>&lt;span style="color:#e6db74">{&lt;/span>argv[&lt;span style="color:#ae81ff">1&lt;/span>]&lt;span style="color:#f92672">.&lt;/span>lower()&lt;span style="color:#f92672">.&lt;/span>replace(&lt;span style="color:#e6db74">&amp;#34; &amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;-&amp;#34;&lt;/span>)&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">.md&amp;#39;&lt;/span>)
now &lt;span style="color:#f92672">=&lt;/span> datetime&lt;span style="color:#f92672">.&lt;/span>now(tz&lt;span style="color:#f92672">=&lt;/span>timezone&lt;span style="color:#f92672">.&lt;/span>utc)
timestamp &lt;span style="color:#f92672">=&lt;/span> now&lt;span style="color:#f92672">.&lt;/span>strftime(&lt;span style="color:#e6db74">&amp;#39;%Y-%m-&lt;/span>&lt;span style="color:#e6db74">%d&lt;/span>&lt;span style="color:#e6db74">T%H:%M:%SZ&amp;#39;&lt;/span>)
&lt;span style="color:#66d9ef">with&lt;/span> open(post_file, &lt;span style="color:#e6db74">&amp;#39;w&amp;#39;&lt;/span>) &lt;span style="color:#66d9ef">as&lt;/span> f:
f&lt;span style="color:#f92672">.&lt;/span>write(&lt;span style="color:#e6db74">f&lt;/span>&lt;span style="color:#e6db74">&amp;#39;+++&lt;/span>&lt;span style="color:#ae81ff">\n&lt;/span>&lt;span style="color:#e6db74">&amp;#39;&lt;/span>
&lt;span style="color:#e6db74">f&lt;/span>&lt;span style="color:#e6db74">&amp;#39;date=&amp;#34;&lt;/span>&lt;span style="color:#e6db74">{&lt;/span>timestamp&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#ae81ff">\n&lt;/span>&lt;span style="color:#e6db74">&amp;#39;&lt;/span>
&lt;span style="color:#e6db74">f&lt;/span>&lt;span style="color:#e6db74">&amp;#39;title=&amp;#34;&lt;/span>&lt;span style="color:#e6db74">{&lt;/span>argv[&lt;span style="color:#ae81ff">1&lt;/span>]&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#ae81ff">\n&lt;/span>&lt;span style="color:#e6db74">&amp;#39;&lt;/span>
&lt;span style="color:#e6db74">f&lt;/span>&lt;span style="color:#e6db74">&amp;#39;description=&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#ae81ff">\n&lt;/span>&lt;span style="color:#e6db74">&amp;#39;&lt;/span>
&lt;span style="color:#e6db74">f&lt;/span>&lt;span style="color:#e6db74">&amp;#39;categories=[]&lt;/span>&lt;span style="color:#ae81ff">\n&lt;/span>&lt;span style="color:#e6db74">&amp;#39;&lt;/span>
&lt;span style="color:#e6db74">f&lt;/span>&lt;span style="color:#e6db74">&amp;#39;tags=[]&lt;/span>&lt;span style="color:#ae81ff">\n&lt;/span>&lt;span style="color:#e6db74">&amp;#39;&lt;/span>
&lt;span style="color:#e6db74">f&lt;/span>&lt;span style="color:#e6db74">&amp;#39;cover=&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#ae81ff">\n&lt;/span>&lt;span style="color:#e6db74">&amp;#39;&lt;/span>
&lt;span style="color:#e6db74">f&lt;/span>&lt;span style="color:#e6db74">&amp;#39;+++&lt;/span>&lt;span style="color:#ae81ff">\n\n&lt;/span>&lt;span style="color:#e6db74">&amp;#39;&lt;/span>)
os_id &lt;span style="color:#f92672">=&lt;/span> system()&lt;span style="color:#f92672">.&lt;/span>lower()
&lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#e6db74">&amp;#39;windows&amp;#39;&lt;/span> &lt;span style="color:#f92672">in&lt;/span> os_id:
call((&lt;span style="color:#e6db74">&amp;#39;start&amp;#39;&lt;/span>, post_file))
&lt;span style="color:#66d9ef">elif&lt;/span> &lt;span style="color:#e6db74">&amp;#39;osx&amp;#39;&lt;/span> &lt;span style="color:#f92672">in&lt;/span> os_id &lt;span style="color:#f92672">or&lt;/span> &lt;span style="color:#e6db74">&amp;#39;darwin&amp;#39;&lt;/span> &lt;span style="color:#f92672">in&lt;/span> os_id:
call((&lt;span style="color:#e6db74">&amp;#39;open&amp;#39;&lt;/span>, post_file))
&lt;span style="color:#66d9ef">else&lt;/span>:
call((&lt;span style="color:#e6db74">&amp;#39;xdg-open&amp;#39;&lt;/span>, post_file))
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Usage:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">python3 hugo-post-generator.py &lt;span style="color:#e6db74">&amp;#34;My beautiful post&amp;#34;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Also check out how to make &lt;a href="https://www.circuitshelter.com/posts/hugo-post-vscode-snippet">VSCode snippet for Hugo post&lt;/a>.&lt;/p></content></item><item><title>Checking host availability with Python and AWS Lambda</title><link>https://www.circuitshelter.com/posts/aws-lambda-python-check-host/</link><pubDate>Mon, 19 Jul 2021 14:30:00 +0000</pubDate><guid>https://www.circuitshelter.com/posts/aws-lambda-python-check-host/</guid><description>AWS Lambda is great for quick and straightforward tasks without any unnecessary functions complications. But Sometimes you need to optimize your approach even for such simple task as checking host availability to make it as fast and minimal as possible.
For this task we are going to use Low-level networking interface from Python 3 to try establish connection directly to remote socket without help of any additional protocols like ICMP.</description><content>&lt;p>&lt;a href="https://aws.amazon.com/lambda/">AWS Lambda&lt;/a> is great for quick and straightforward tasks without any unnecessary functions complications.
But Sometimes you need to optimize your approach even for such simple task as checking host availability to make it as fast and minimal as possible.&lt;/p>
&lt;p>For this task we are going to use &lt;a href="https://docs.python.org/3/library/socket.html">Low-level networking interface from Python 3&lt;/a> to try establish connection directly to remote socket without help of any additional protocols like &lt;a href="https://en.wikipedia.org/wiki/Internet_Control_Message_Protocol">ICMP&lt;/a>.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#f92672">from&lt;/span> socket &lt;span style="color:#f92672">import&lt;/span> socket, AF_INET, SOCK_STREAM
addresses &lt;span style="color:#f92672">=&lt;/span> [
{&lt;span style="color:#e6db74">&amp;#39;example.com&amp;#39;&lt;/span>: &lt;span style="color:#ae81ff">80&lt;/span>},
{&lt;span style="color:#e6db74">&amp;#39;example.com&amp;#39;&lt;/span>: &lt;span style="color:#ae81ff">443&lt;/span>},
{&lt;span style="color:#e6db74">&amp;#39;host-1234567890-notexist.example.com&amp;#39;&lt;/span>: &lt;span style="color:#ae81ff">1234&lt;/span>}]
&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">echo&lt;/span>(addresses: list):
results &lt;span style="color:#f92672">=&lt;/span> {}
&lt;span style="color:#66d9ef">for&lt;/span> address &lt;span style="color:#f92672">in&lt;/span> addresses:
&lt;span style="color:#66d9ef">for&lt;/span> host, port &lt;span style="color:#f92672">in&lt;/span> address&lt;span style="color:#f92672">.&lt;/span>items():
&lt;span style="color:#66d9ef">try&lt;/span>:
s &lt;span style="color:#f92672">=&lt;/span> socket(AF_INET, SOCK_STREAM)
s&lt;span style="color:#f92672">.&lt;/span>connect((str(host), int(port)))
&lt;span style="color:#66d9ef">except&lt;/span> &lt;span style="color:#a6e22e">OSError&lt;/span>:
results[&lt;span style="color:#e6db74">f&lt;/span>&lt;span style="color:#e6db74">&amp;#39;&lt;/span>&lt;span style="color:#e6db74">{&lt;/span>host&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">:&lt;/span>&lt;span style="color:#e6db74">{&lt;/span>port&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">&amp;#39;&lt;/span>] &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">False&lt;/span>
&lt;span style="color:#66d9ef">else&lt;/span>:
s&lt;span style="color:#f92672">.&lt;/span>close
results[&lt;span style="color:#e6db74">f&lt;/span>&lt;span style="color:#e6db74">&amp;#39;&lt;/span>&lt;span style="color:#e6db74">{&lt;/span>host&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">:&lt;/span>&lt;span style="color:#e6db74">{&lt;/span>port&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">&amp;#39;&lt;/span>] &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">True&lt;/span>
&lt;span style="color:#66d9ef">return&lt;/span> results
&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">lambda_handler&lt;/span>(event, context):
&lt;span style="color:#66d9ef">return&lt;/span> echo(addresses)
&lt;/code>&lt;/pre>&lt;/div></content></item><item><title>VSCode snippet for Hugo post</title><link>https://www.circuitshelter.com/posts/hugo-post-vscode-snippet/</link><pubDate>Thu, 15 Jul 2021 03:19:47 +0000</pubDate><guid>https://www.circuitshelter.com/posts/hugo-post-vscode-snippet/</guid><description>{ // Setup your timezone after ${CURRENT_SECOND}, default: &amp;#34;Z&amp;#34; (UTC) &amp;#34;Hugo Post&amp;#34;: { &amp;#34;prefix&amp;#34;: [&amp;#34;hugo&amp;#34;], &amp;#34;scope&amp;#34;: &amp;#34;markdown&amp;#34;, &amp;#34;body&amp;#34;: [ &amp;#34;+++&amp;#34;, &amp;#34;date = \&amp;#34;${CURRENT_YEAR}-${CURRENT_MONTH}-${CURRENT_DATE}T${CURRENT_HOUR}:${CURRENT_MINUTE}:${CURRENT_SECOND}Z\&amp;#34;&amp;#34;, &amp;#34;title = \&amp;#34;$1\&amp;#34;&amp;#34;, &amp;#34;description = \&amp;#34;$2\&amp;#34;&amp;#34;, &amp;#34;tags = [\&amp;#34;$3\&amp;#34;]&amp;#34;, &amp;#34;categories = [\&amp;#34;$4\&amp;#34;]&amp;#34;, &amp;#34;cover = \&amp;#34;$5\&amp;#34;&amp;#34;, &amp;#34;+++\n&amp;#34;, &amp;#34;$0&amp;#34;], &amp;#34;description&amp;#34;: &amp;#34;A Hugo post template&amp;#34; } } Guide https://code.visualstudio.com/docs/editor/userdefinedsnippets#_creating-your-own-snippets</description><content>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-json" data-lang="json">{
&lt;span style="color:#960050;background-color:#1e0010">//&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">Setup&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">your&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">timezone&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">after&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">${CURRENT_SECOND&lt;/span>}&lt;span style="color:#960050;background-color:#1e0010">,&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">default:&lt;/span> &lt;span style="color:#e6db74">&amp;#34;Z&amp;#34;&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">(UTC)&lt;/span>
&lt;span style="color:#e6db74">&amp;#34;Hugo Post&amp;#34;&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">:&lt;/span> {
&lt;span style="color:#f92672">&amp;#34;prefix&amp;#34;&lt;/span>: [&lt;span style="color:#e6db74">&amp;#34;hugo&amp;#34;&lt;/span>],
&lt;span style="color:#f92672">&amp;#34;scope&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;markdown&amp;#34;&lt;/span>,
&lt;span style="color:#f92672">&amp;#34;body&amp;#34;&lt;/span>: [
&lt;span style="color:#e6db74">&amp;#34;+++&amp;#34;&lt;/span>,
&lt;span style="color:#e6db74">&amp;#34;date = \&amp;#34;${CURRENT_YEAR}-${CURRENT_MONTH}-${CURRENT_DATE}T${CURRENT_HOUR}:${CURRENT_MINUTE}:${CURRENT_SECOND}Z\&amp;#34;&amp;#34;&lt;/span>,
&lt;span style="color:#e6db74">&amp;#34;title = \&amp;#34;$1\&amp;#34;&amp;#34;&lt;/span>,
&lt;span style="color:#e6db74">&amp;#34;description = \&amp;#34;$2\&amp;#34;&amp;#34;&lt;/span>,
&lt;span style="color:#e6db74">&amp;#34;tags = [\&amp;#34;$3\&amp;#34;]&amp;#34;&lt;/span>,
&lt;span style="color:#e6db74">&amp;#34;categories = [\&amp;#34;$4\&amp;#34;]&amp;#34;&lt;/span>,
&lt;span style="color:#e6db74">&amp;#34;cover = \&amp;#34;$5\&amp;#34;&amp;#34;&lt;/span>,
&lt;span style="color:#e6db74">&amp;#34;+++\n&amp;#34;&lt;/span>,
&lt;span style="color:#e6db74">&amp;#34;$0&amp;#34;&lt;/span>],
&lt;span style="color:#f92672">&amp;#34;description&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;A Hugo post template&amp;#34;&lt;/span>
}
&lt;span style="color:#960050;background-color:#1e0010">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="guide">Guide&lt;/h1>
&lt;p>&lt;a href="https://code.visualstudio.com/docs/editor/userdefinedsnippets#_creating-your-own-snippets">https://code.visualstudio.com/docs/editor/userdefinedsnippets#_creating-your-own-snippets&lt;/a>&lt;/p></content></item></channel></rss>